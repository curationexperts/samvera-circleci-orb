description: Box running FCRepo, Solr, and Ruby.
parameters:
  fcrepo_version:
    type: string
    default: '4.7'
  ruby_version:
    type: string
    default: '2.5.5'
  solr_port:
    type: string
    default: '8985'
docker:
  - image: circleci/ruby:<< parameters.ruby_version >>-node-browsers-legacy
  - image: ualbertalib/docker-fcrepo4:<< parameters.fcrepo_version>>
    environment:
      CATALINA_OPTS: "-Djava.awt.headless=true -Dfile.encoding=UTF-8 -server -Xms512m -Xmx1024m -XX:NewSize=256m -XX:MaxNewSize=256m -XX:PermSize=256m -XX:MaxPermSize=256m -XX:+DisableExplicitGC"
  - image: solr:7-alpine
    command: bin/solr -cloud -noprompt -f -p <<parameters.solr_port>>
environment:
  BUNDLE_PATH: vendor/bundle
  BUNDLE_JOBS: 4
  BUNDLE_RETRY: 3
  RAILS_ENV: test
  RACK_ENV: test
  FCREPO_TEST_PORT: 8080/fcrepo
  SPEC_OPTS: --profile 10 --format RspecJunitFormatter --out /tmp/test-results/rspec.xml --format progress
